#!/bin/bash

function untar_payload {
	match=$(grep --text --line-number '^PAYLOAD:$' $0 | cut -d ':' -f 1)
	payload_start=$((match + 1))
	tail -n +$payload_start $0 | tar -xzf -
}

if [[ ! -d ".spm/paklib" || ! -e ".spm/bin/spm" ]]; then
	untar_payload
fi

./.spm/bin/spm $@
exit $?
