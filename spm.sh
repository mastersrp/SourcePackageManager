#!/bin/bash

[[ "$PAKLIB_ROOT" == "" ]] && export PAKLIB_ROOT=$(pwd -P)/.spm/paklib

for arg in "$@"; do
	[[ "$arg" == "--force-unpack" ]] && force_unpack = true
done

function untar_payload {
	match=$(grep --text --line-number '^PAYLOAD:$' $0 | cut -d ':' -f 1)
	payload_start=$((match + 1))
	tail -n +$payload_start $0 | base64 -d | tar -xjf -
}

if [[ ! -d "${PAKLIB_ROOT}" || "$force_unpack" == "true" ]]; then
	untar_payload
fi
export LUA_PATH=${PAKLIB_ROOT}/?.lua
install -d build/
lua ${PAKLIB_ROOT}/main.lua $@
exit $?
PAYLOAD:
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
