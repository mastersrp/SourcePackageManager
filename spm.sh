#!/bin/bash

[[ "$PAKLIB_ROOT" == "" ]] && export PAKLIB_ROOT=$(pwd -P)/.spm/paklib

for arg in "$@"; do
	[[ "$arg" == "--force-unpack" ]] && force_unpack = true
done

function untar_payload {
	match=$(grep --text --line-number '^PAYLOAD:$' $0 | cut -d ':' -f 1)
	payload_start=$((match + 1))
	tail -n +$payload_start $0 | base64 -d | tar -xjf -
}

if [[ ! -d "${PAKLIB_ROOT}" || "$force_unpack" == "true" ]]; then
	untar_payload
fi
export LUA_PATH=${PAKLIB_ROOT}/?.lua
install -d build/
lua ${PAKLIB_ROOT}/main.lua $@
exit $?
PAYLOAD:
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
4u5IpwoSB/uq02A=
